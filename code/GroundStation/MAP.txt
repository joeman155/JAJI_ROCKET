Summary
-----------
Shows information on how I set-up configured the map system

It is probably a VERY good idea to load the maps into a plsql DB on a FAST system...
export the loaded DB...
Import into a slow system.

This is bcause running osmosis and osm2pgsql on slow Rasberry-Pi 2 Model B is painful
and it might damage microSD....too many writes...possibly.

OS Deps
--------
Log on as user root

apt-get install postgresql postgresql-contrib

apt-get install osm2pgsql 



Downloading the map
---------------------
Went to:-

http://www.openstreetmap.org

Click on Export

Clicked on hyper link "Manually select a different area"

Choose the area I wanted 

Clicked on hyperlink "Overpass API" and let it download


** Didn't work ...download failed..


Went to:-

http://download.geofabrik.de/

When to "Australia and Oceana" -> Australia 

Download


wget http://download.geofabrik.de/australia-oceania/australia-latest.osm.bz2

bunzip2 australia-latest.osm.bz2



Extracting a 'region' of Australia map for load
--------------

apt-get install osmosis

Create a file called east.poly  


osmosis --read-xml file="australia-latest.osm" --bounding-polygon file="east.poly" \
        --write-xml file="east.australia-latest.osm"


bzip2 east.australia-latest.osm


or

osmosis --read-xml file="australia-latest.osm" --bounding-polygon file="qld.poly" \
        --write-xml file="qld.australia-latest.osm"


bzip2 qld.australia-latest.osm

Then Transfer this file to /data/maps


NOTE: Sample scripts and poly files are in the maps directory



Installing map software
---------------
Log on as user root

su - postgres

createdb gis

createlang plpgsql gis                                         


cd /usr/share/postgresql/9.1/contrib/postgis-1.5/
psql -d gis -f postgis.sql                                            

cd /usr/share/postgresql/9.1/contrib
psql -d gis -f postgis_comments.sql                                   

psql -d gis 
create extension hstore;

control-d

cd /usr/share/postgresql/9.1/contrib/postgis-1.5
psql -d gis -f spatial_ref_sys.sql  





Loading osm map into Postgres database gis
------------------
as postgres user:-


Here is an example of loading QLD map

cd /data/maps/
osm2pgsql qld.australia-latest.osm.bz2 -d gis -U postgres -P 5432 \
          -S /usr/share/osm2pgsql/default.style --hstore


Transferring Postgres database to slower system
------------
On fast source system, type:-


pg_dump gis > /tmp/gis.dmp

Transfer to slow system


Create GIS database as follows:-

Log on as user postgres and run the commands below:-

createuser pi   # anser yes for superuser
createdb -E UTF8 -O pi gis
createlang plpgsql gis

psql -U pi -d gis


create extension hstore;

control-d


Log in as user pi

Then import database:-

psql -U pi -d gis < gis.dmp



Open 
/etc/postgresql/9.1/main/pg_hba.conf

Add the line:-

local   gis             pi                                      trust


service postgresql restart



Installing Renderer INIT script
-------------------------------
As user root on Rasberry-Pi
cp /data/src/mod_tile/debian/renderd.init /etc/init.d/

vi /etc/init.d/renderd.init

and make following changes:-

19c19
< DAEMON=/usr/local/bin/$NAME
---
> DAEMON=/usr/bin/$NAME
24c24
< RUNASUSER=pi
---
> RUNASUSER=www-data


chmod a+x /etc/init.d/renderd.init

chkconfig renderd.init on


/etc/init.d/renderd.init start



Loading standard OpenStreetMap Style.
---------------
Load into DB using openstreetmap-carto.style

osm2pgsql qld.australia-latest.osm.bz2 -d gis -U postgres -P 5432 \
          -S openstreetmap-carto.style --hstore

(You'll need to get openstreetmap-carto.style over to server where running osm2pgsql...if doing 
 load on a faster machine)



You then need to create the style .xml file for mapnik

On the Rasberry-Pi machine as the user pi

cd /data/maps/
mkdir style2
cd style2
git clone https://github.com/gravitystorm/openstreetmap-carto.git

cd openstreetmap-carto/

./get-shapefiles.sh

Open project.mml
and put in absolute path to the shp files

carto project.mml > carto.xml


Then put the following line in /etc/renderd.conf

XML=/data/maps/style/OSMBright/carto.xml

Restart Rendered
